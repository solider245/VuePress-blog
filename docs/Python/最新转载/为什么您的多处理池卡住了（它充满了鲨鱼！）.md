---
title : ä¸ºä»€ä¹ˆæ‚¨çš„å¤šå¤„ç†æ± å¡ä½äº†ï¼ˆå®ƒå……æ»¡äº†é²¨é±¼ï¼ï¼‰
description : åœ¨æ­¤å¤„æ·»æè¿°
author : ä¸­ç®­çš„å´èµ·
image : åœ¨æ­¤å¤„æ”¾ä¸Šå›¾ç‰‡é“¾æ¥
date : 2020-08-23 11:59:05 +0800
categories:
 -
tags:
 -
---
[[toc]]
æ‚¨æ­£åœ¨`multiprocessing`è·¨å¤šä¸ªè¿›ç¨‹è¿è¡Œä¸€äº›ä»£ç ï¼Œè€Œè¿™äº›ä»£ç åªæ˜¯ååœ¨é‚£é‡Œã€‚å¡ä½äº†

æ‚¨æ£€æŸ¥CPUä½¿ç”¨ç‡-ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œå®ƒæ²¡æœ‰åšä»»ä½•å·¥ä½œã€‚

è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç æ¥è§£å†³æ­¤é—®é¢˜ï¼ˆè·³åˆ°æœ€åè¿›è¡Œå°è¯•ï¼‰ï¼Œä½†æ˜¯é¦–å…ˆï¼Œæ˜¯æ—¶å€™æ·±å…¥ç ”ç©¶Pythonçš„ç¼ºé™·å’ŒPOSIXç³»ç»Ÿç¼–ç¨‹çš„ç—›è‹¦äº†ï¼Œä½¿ç”¨ä»¤äººå…´å¥‹çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å¾ˆç®€å•ã€‚ä»¤äººä¿¡æœçš„é²¨é±¼ä¸»é¢˜éšå–»ï¼

è®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ¯”å–»çš„åœºæ™¯ï¼šæ‚¨åœ¨å……æ»¡é²¨é±¼çš„æ¸¸æ³³æ± é‡Œæ¸¸æ³³ã€‚ï¼ˆé²¨é±¼æ˜¯æµç¨‹çš„éšå–»ã€‚ï¼‰

æ¥ä¸‹æ¥ï¼Œæ‚¨æ‹¿å‰å­ã€‚ï¼ˆå‰å­æ˜¯çš„éšå–»`fork()`ã€‚ï¼‰

æ‚¨ç”¨å‰å­åˆºäº†ä¸€ä¸‹è‡ªå·±ã€‚åˆºåˆºåˆºã€‚é²œè¡€å¼€å§‹æ¸—å‡ºï¼Œé²¨é±¼å¼€å§‹ç›˜æ—‹ï¼Œå¾ˆå¿«ä½ å°±ä¼šå‘ç°è‡ªå·±æ­»äº†-æ­»åœ¨æ°´ä¸­ï¼

åœ¨ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹ä¸­ï¼Œæ‚¨å°†é‡åˆ°ï¼š

*   ç¥ç§˜çš„å¤±è´¥ï¼Œå…¶ä¸­Python `multiprocessing.Pool`é™·å…¥äº†åƒµå±€ã€‚
*   ç¥ç§˜çš„æ ¹æºï¼š`fork()`ã€‚
*   ä¸€ä¸ªéš¾é¢˜ï¼Œå…¶ä¸­`fork()`å¤åˆ¶æ‰€æœ‰å†…å®¹éƒ½æ˜¯é—®é¢˜ï¼Œè€Œ`fork()`ä¸æ˜¯å¤åˆ¶æ‰€æœ‰å†…å®¹ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚
*   ä¸€äº›åˆ›å¯è´´ä¸èƒ½æ­¢è¡€ã€‚
*   è¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥é˜²æ­¢æ‚¨çš„ä»£ç è¢«é²¨é±¼åƒæ‰ã€‚

è®©æˆ‘ä»¬å¼€å§‹ï¼

ç®€ä»‹ `multiprocessing.Pool`
-------------------------

Pythonæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ¨¡å—ï¼Œå…è®¸æ‚¨åœ¨è¿›ç¨‹æ± ä¸­è¿è¡Œä»»åŠ¡ï¼Œè¿™æ˜¯æ”¹å–„ç¨‹åºå¹¶è¡Œæ€§çš„å¥½æ–¹æ³•ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œè¿™äº›ç¤ºä¾‹å‡æœªåœ¨Windowsä¸Šè¿›è¡Œè¿‡æµ‹è¯•ï¼›æˆ‘åœ¨è¿™é‡Œé‡ç‚¹å…³æ³¨* nixå¹³å°ã€‚ï¼‰

```py
from multiprocessing import Pool
from os import getpid

def double(i):
    print("I'm process", getpid())
    return i * 2

if __name__ == '__main__':
    with Pool() as pool:
        result = pool.map(double, [1, 2, 3, 4, 5])
        print(result) 
```

å¦‚æœè¿è¡Œæ­¤å‘½ä»¤ï¼Œåˆ™ä¼šå¾—åˆ°ï¼š

```
I'm process 4942
I'm process 4943
I'm process 4944
I'm process 4942
I'm process 4943
[2, 4, 6, 8, 10] 
```

å¦‚æ‚¨æ‰€è§ï¼Œè¯¥`double()`å‡½æ•°åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œã€‚

ä¸€äº›ä»£ç åº”è¯¥èµ·ä½œç”¨ï¼Œä½†æ˜¯ä¸èµ·ä½œç”¨
----------------

ä¸å¹¸çš„æ˜¯ï¼Œå°½ç®¡è¯¥`Pool`è¯¾ç¨‹å¾ˆæœ‰ç”¨ï¼Œä½†ä¹Ÿå……æ»¡äº†æ¶æ¯’çš„é²¨é±¼ï¼Œåªç­‰æ‚¨çŠ¯äº†ä¸€ä¸ªé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å®Œå…¨åˆç†çš„ä»£ç ï¼š

```py
import logging
from threading import Thread
from queue import Queue
from logging.handlers import QueueListener, QueueHandler
from multiprocessing import Pool

def setup_logging():
    # Logs get written to a queue, and then a thread reads
    # from that queue and writes messages to a file:
    _log_queue = Queue()
    QueueListener(
        _log_queue, logging.FileHandler("out.log")).start()
    logging.getLogger().addHandler(QueueHandler(_log_queue))

    # Our parent process is running a thread that
    # logs messages:
    def write_logs():
        while True:
            logging.error("hello, I just did something")
    Thread(target=write_logs).start()

def runs_in_subprocess():
    print("About to log...")
    logging.error("hello, I did something")
    print("...logged")

if __name__ == '__main__':
    setup_logging()

    # Meanwhile, we start a process pool that writes some
    # logs. We do this in a loop to make race condition more
    # likely to be triggered.
    while True:
        with Pool() as pool:
            pool.apply(runs_in_subprocess) 
```

è¯¥ç¨‹åºçš„ä½œç”¨å¦‚ä¸‹ï¼š

1.  åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œæ—¥å¿—æ¶ˆæ¯è¢«è·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œå¹¶ä¸”çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è¯»å–å¹¶å°†è¿™äº›æ¶ˆæ¯å†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚
2.  å¦ä¸€ä¸ªçº¿ç¨‹ç¼–å†™è¿ç»­çš„æ—¥å¿—æ¶ˆæ¯æµã€‚
3.  æœ€åï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ± ï¼Œå¹¶åœ¨ä¸€ä¸ªå­å­è¿›ç¨‹ä¸­è®°å½•ä¸€æ¡æ¶ˆæ¯ã€‚

å¦‚æœæˆ‘ä»¬åœ¨Linuxä¸Šè¿è¡Œè¯¥ç¨‹åºï¼Œåˆ™ä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

```shell
About to log...
...logged
About to log...
...logged
About to log...
<at this point the program freezes> 
```

ä¸ºä»€ä¹ˆè¯¥ç¨‹åºå†»ç»“ï¼Ÿ

å¦‚ä½•åœ¨POSIXï¼ˆä»¥å‰ç§°ä¸ºUnixçš„æ ‡å‡†ï¼‰ä¸Šå¯åŠ¨å­æµç¨‹
---------------------------

è¦äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œæ‚¨éœ€è¦äº†è§£å¦‚ä½•åœ¨POSIXï¼ˆå³Linuxï¼ŒBSDï¼ŒmacOSç­‰ï¼‰ä¸Šå¯åŠ¨å­æµç¨‹ã€‚

1.  ä½¿ç”¨`fork()`ç³»ç»Ÿè°ƒç”¨åˆ›å»ºè¯¥è¿‡ç¨‹çš„å‰¯æœ¬ã€‚
2.  å­è¿›ç¨‹ä½¿ç”¨`execve()`ç³»ç»Ÿè°ƒç”¨ï¼ˆæˆ–å…¶å˜ä½“ä¹‹ä¸€ï¼Œä¾‹å¦‚`execl()`ï¼‰å°†è‡ªå·±æ›¿æ¢ä¸ºå…¶ä»–ç¨‹åºã€‚

å…³é”®æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æ‚¨ä»…åšæŸäº‹`fork()`ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬`fork()`ç„¶åæ‰“å°å½“å‰è¿›ç¨‹çš„è¿›ç¨‹IDï¼ˆPIDï¼‰ï¼š

```py
from os import fork, getpid

print("I am parent process", getpid())
if fork():
    print("I am the parent process, with PID", getpid())
else:
    print("I am the child process, with PID", getpid()) 
```

å½“æˆ‘ä»¬è¿è¡Œå®ƒæ—¶ï¼š

```
I am parent process 3619
I am the parent process, with PID 3619
I am the child process, with PID 3620 
```

å¦‚æ‚¨æ‰€è§ï¼Œçˆ¶çº§ï¼ˆPID 3619ï¼‰å’Œå­çº§ï¼ˆPID 3620ï¼‰éƒ½ç»§ç»­è¿è¡Œç›¸åŒçš„Pythonä»£ç ã€‚

è¿™å°±æ˜¯æœ‰è¶£çš„åœ°æ–¹ï¼š\- `fork()`ä»…æ˜¯Pythonåœ¨Linuxä¸Šé»˜è®¤åˆ›å»ºè¿›ç¨‹æ± çš„æ–¹å¼ï¼Œè€Œåœ¨Python 3.7å’Œæ›´æ—©ç‰ˆæœ¬çš„macOSä¸Šåˆ›å»ºè¿›ç¨‹æ± çš„æ–¹å¼ã€‚

åªæœ‰è¿™ä¸ªé—®é¢˜`fork()`ING
-----------------

å¥½çš„ï¼ŒPythonåªéœ€æ‰§è¡Œå³å¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ± `fork()`ã€‚è¿™ä¼¼ä¹å¾ˆæ–¹ä¾¿ï¼šå­è¿›ç¨‹å¯ä»¥è®¿é—®çˆ¶è¿›ç¨‹å†…å­˜ä¸­æ‰€æœ‰å†…å®¹çš„å‰¯æœ¬ï¼ˆå°½ç®¡å­è¿›ç¨‹æ— æ³•å†_æ›´æ”¹_çˆ¶è¿›ç¨‹ä¸­çš„ä»»ä½•å†…å®¹ï¼‰ã€‚ä½†æ˜¯ï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆé€ æˆäº†æˆ‘ä»¬çœ‹åˆ°çš„åƒµå±€ï¼Ÿ

åŸå› æ˜¯åœ¨`fork()`-without- ä¹‹åç»§ç»­è¿è¡Œä»£ç çš„ä¸¤ä¸ªé—®é¢˜`execve()`ï¼š

1.  `fork()` å¤åˆ¶å†…å­˜ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚
2.  ä½†è¿™å¹¶ä¸èƒ½å¤åˆ¶_æ‰€æœ‰å†…å®¹_ã€‚

### `fork()` å¤åˆ¶å†…å­˜ä¸­çš„æ‰€æœ‰å†…å®¹

æ‰§è¡Œæ—¶`fork()`ï¼Œå®ƒå°†å¤åˆ¶å†…å­˜ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚è¿™åŒ…æ‹¬æ‚¨åœ¨å¯¼å…¥çš„Pythonæ¨¡å—ä¸­è®¾ç½®çš„æ‰€æœ‰å…¨å±€å˜é‡ã€‚

ä¾‹å¦‚ï¼Œæ‚¨çš„`logging`é…ç½®ï¼š

```py
import logging
from multiprocessing import Pool
from os import getpid

def runs_in_subprocess():
    logging.info(
        "I am the child, with PID {}".format(getpid()))

if __name__ == '__main__':
    logging.basicConfig(
        format='GADZOOKS %(message)s', level=logging.DEBUG)

    logging.info(
        "I am the parent, with PID {}".format(getpid()))

    with Pool() as pool:
        pool.apply(runs_in_subprocess) 
```

å½“æˆ‘ä»¬è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š

```
GADZOOKS I am the parent, with PID 3884
GADZOOKS I am the child, with PID 3885 
```

æ³¨æ„æ± ä¸­çš„å­è¿›ç¨‹å¦‚ä½•ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ—¥å¿—è®°å½•é…ç½®ï¼Œå³ä½¿è¿™ä¸æ˜¯æ‚¨çš„æ„å›¾ï¼æ›´å¹¿æ³›åœ°è®²ï¼Œæ‚¨åœ¨çˆ¶çº§ä¸­åœ¨æ¨¡å—çº§åˆ«é…ç½®çš„_ä»»ä½•å†…å®¹_éƒ½å°†è¢«æ± ä¸­çš„è¿›ç¨‹ç»§æ‰¿ï¼Œè¿™å¯èƒ½å¯¼è‡´æŸäº›æ„å¤–è¡Œä¸ºã€‚

### ä½†`fork()`ä¸ä¼šå¤åˆ¶æ‰€æœ‰å†…å®¹

ç¬¬äºŒä¸ªé—®é¢˜æ˜¯`fork()`å®é™…ä¸Šå¹¶æ²¡æœ‰å¤åˆ¶æ‰€æœ‰å†…å®¹ã€‚ç‰¹åˆ«æ˜¯ï¼Œ`fork()` _æ²¡æœ‰_å¤åˆ¶çš„ä¸€ä»¶äº‹æ˜¯çº¿ç¨‹ã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­è¿è¡Œçš„ä»»ä½•çº¿ç¨‹åœ¨å­è¿›ç¨‹ä¸­éƒ½ä¸å­˜åœ¨ã€‚

```py
from threading import Thread, enumerate
from os import fork
from time import sleep

# Start a thread: Thread(target=lambda: sleep(60)).start()

if fork():
    print("The parent process has {} threads".format(
        len(enumerate())))
else:
    print("The child process has {} threads".format(
        len(enumerate()))) 
```

å½“æˆ‘ä»¬è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯åŠ¨çš„çº¿ç¨‹æ— æ³•å¹¸å­˜`fork()`ï¼š

```
The parent process has 2 threads
The child process has 1 threads 
```

è°œå›¢è§£å†³äº†
-----

è¿™å°±æ˜¯åŸå§‹ç¨‹åºé™·å…¥åƒµå±€çš„åŸå› -ç»“åˆå®ƒä»¬çš„åŠ›é‡ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜`fork()`-åªä¼šäº§ç”Ÿä¸€ä¸ªæ›´å¤§ï¼Œæ›´ä¸¥é‡çš„é—®é¢˜ï¼š

1.  åªè¦çˆ¶è¿›ç¨‹ä¸­çš„çº¿ç¨‹å†™å…¥æ—¥å¿—æ¶ˆæ¯ï¼Œå°±ä¼šå°†å…¶æ·»åŠ åˆ°ä¸­`Queue`ã€‚è¿™æ¶‰åŠè·å–é”ã€‚
2.  å¦‚æœ`fork()`åœ¨é”™è¯¯çš„æ—¶é—´å‘ç”Ÿï¼Œåˆ™å°†é”å®šä»¥è·å–çŠ¶æ€å¤åˆ¶ã€‚
3.  å­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„æ—¥å¿—è®°å½•é…ç½®ï¼ˆåŒ…æ‹¬é˜Ÿåˆ—ï¼‰ã€‚
4.  æ¯å½“å­è¿›ç¨‹å†™å…¥æ—¥å¿—æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†å°è¯•å°†å…¶å†™å…¥é˜Ÿåˆ—ã€‚
5.  è¿™æ„å‘³ç€è¦è·å–é”ï¼Œä½†æ˜¯å·²ç»è·å–äº†é”ã€‚
6.  ç°åœ¨ï¼Œå­è¿›ç¨‹ç­‰å¾…é‡Šæ”¾é”ã€‚
7.  æ°¸è¿œä¸ä¼šé‡Šæ”¾è¯¥é”ï¼Œå› ä¸ºä¸ä¼šé‡Šæ”¾è¯¥é”çš„çº¿ç¨‹`fork()`ã€‚

ç®€åŒ–å½¢å¼ï¼š

```py
from os import fork
from threading import Lock

# Lock is acquired in the parent process: lock = Lock()
lock.acquire()

if fork() == 0:
    # In the child process, try to grab the lock:
    print("Acquiring lock...")
    lock.acquire()
    print("Lock acquired! (This code will never run)") 
```

åˆ›å¯è´´å’Œè§£å†³æ–¹æ³•
--------

æœ‰ä¸€äº›å˜é€šåŠæ³•å¯ä»¥ä½¿å®ƒæ›´å¥½ä¸€äº›ã€‚

å¯¹äºæ¨¡å—çŠ¶æ€ï¼Œ`logging`å½“å­è¿›ç¨‹ç”±å¯åŠ¨æ—¶ï¼Œåº“å¯ä»¥é‡ç½®å…¶é…ç½®`multiprocessing.Pool`ã€‚ä½†æ˜¯ï¼Œè¿™ä¸èƒ½è§£å†³æ‰€æœ‰_å…¶ä»–_è®¾ç½®æŸç§æ¨¡å—çº§åˆ«å…¨å±€çŠ¶æ€çš„_å…¶ä»–_ Pythonæ¨¡å—å’Œåº“çš„é—®é¢˜ã€‚æ¯ä¸ªè¿™æ ·åšçš„åº“éƒ½éœ€è¦ä¿®å¤æ‰èƒ½ä¸ä¸€èµ·ä½¿ç”¨`multiprocessing`ã€‚

å¯¹äºçº¿ç¨‹ï¼Œå¯ä»¥åœ¨`fork()`è°ƒç”¨æ—¶å°†é”è®¾ç½®å›é‡Šæ”¾çŠ¶æ€ï¼ˆPythonå¯¹æ­¤æä¾›äº†[ç¥¨è¯](https://bugs.python.org/issue6721)ã€‚ï¼‰ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸èƒ½è§£å†³Cåº“åˆ›å»ºçš„é”çš„é—®é¢˜ï¼Œå®ƒåªèƒ½è§£å†³Pythonç›´æ¥åˆ›å»ºçš„é”ã€‚å®ƒå¹¶æ²¡æœ‰è§£å†³è¿™æ ·çš„äº‹å®ï¼Œå³æ— è®ºè¿™äº›é”æ˜¯å¦å·²é‡Šæ”¾ï¼Œè¿™äº›é”åœ¨å­è¿›ç¨‹ä¸­å®é™…ä¸Šéƒ½ä¸å†æœ‰æ„ä¹‰ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ›´å¥½ï¼Œæ›´è½»æ¾çš„è§£å†³æ–¹æ¡ˆã€‚

çœŸæ­£çš„è§£å†³æ–¹æ¡ˆï¼šåœæ­¢`fork()`æŠ±æ€¨
--------------------

åœ¨Python 3ä¸­ï¼Œè¯¥`multiprocessing`åº“æ·»åŠ äº†å¯åŠ¨å­æµç¨‹çš„æ–°æ–¹æ³•ã€‚å…¶ä¸­ä¸€ä¸ªåšäº†`fork()`ä¹‹åæ˜¯`execve()`ä¸€ä¸ªå®Œå…¨æ–°çš„Pythonç¨‹åºã€‚è¿™å°±è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼Œå› ä¸ºæ¨¡å—çŠ¶æ€ä¸è¢«å­è¿›ç¨‹ç»§æ‰¿ï¼šå®ƒä»å¤´å¼€å§‹ã€‚

å¯ç”¨æ­¤å¤‡ç”¨é…ç½®éœ€è¦åœ¨ç¨‹åºçš„ä»»ä½•å…¶ä»–å¯¼å…¥æˆ–ä½¿ç”¨ä¹‹å‰åªæ›´æ”¹ç¨‹åºä¸­çš„ä¸¤è¡Œä»£ç `multiprocessing`ã€‚åŸºæœ¬ä¸Šï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºè¦åšçš„ç¬¬ä¸€ä»¶äº‹åº”è¯¥æ˜¯ï¼š

```
from multiprocessing import set_start_method
set_start_method("spawn") 
```

è¿™ä¼šå…¨å±€æ›´æ”¹ç¨‹åºä¸­æ‰€æœ‰ä»£ç çš„å†…å®¹ï¼Œå› æ­¤ï¼Œå¦‚æœè¦ç»´æŠ¤åº“ï¼Œé‚£ä¹ˆæœ‰ç¤¼è²Œçš„äº‹æƒ…æ˜¯ä»…å¯¹è‡ªå·±çš„æ± ä½¿ç”¨â€œ spawnâ€æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```py
from multiprocessing import get_context

def your_func():
    with get_context("spawn").Pool() as pool:
        # ... everything else is unchanged 
```

å°±æ˜¯è¿™æ ·ï¼šè¿™æ ·åšï¼Œæˆ‘ä»¬å·²ç»è§£å†³çš„æ‰€æœ‰é—®é¢˜éƒ½ä¸ä¼šå½±å“æ‚¨ã€‚ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[ä¸Šä¸‹æ–‡æ–‡æ¡£](https://docs.python.org/3/library/multiprocessing.html#contexts-and-start-methods)ã€‚ï¼‰

ä½†è¿™ä»ç„¶éœ€è¦_æ‚¨_å»åšã€‚å¹¶ä¸”å®ƒè¦æ±‚æ¯ä¸ªä¿¡ä»»åœ°éµå¾ªæ–‡æ¡£ä¸­ç¤ºä¾‹çš„Pythonç”¨æˆ·éƒ½è¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆä»–ä»¬çš„ç¨‹åºæœ‰æ—¶ä¼šå‡ºé”™ã€‚

å½“å‰çš„é»˜è®¤è®¾ç½®å·²è¢«ç ´åï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼ŒPythonä¼šå¯¹æ­¤è¿›è¡Œè®°å½•ï¼Œæˆ–è€…æœ€å¥½å°†å…¶æ›´æ”¹ä¸ºä¸å†æ˜¯é»˜è®¤è®¾ç½®ã€‚

äº†è§£æ›´å¤š
----

æˆ‘åœ¨è¿™é‡Œçš„è§£é‡Šå½“ç„¶æœ‰æ‰€ç®€åŒ–ï¼šä¾‹å¦‚ï¼Œé™¤äº†çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çŠ¶æ€`fork()`æ— æ³•å¤åˆ¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…¶ä»–èµ„æºï¼š

*   é˜…è¯»[Linuxæ‰‹å†Œé¡µ](http://man7.org/linux/man-pages/man2/fork.2.html)çš„`fork()`äº†è§£å…¶ä»–çš„ä¸œè¥¿å®ƒä¸ä¼šå¤åˆ¶ã€‚
*   é›·åˆ‡å°”ç”±æ¹¾ä¸Šå[ä¸ºä»€ä¹ˆçº¿ç¨‹å’Œè¿›ç¨‹ä¸è¦æ··ç”¨](https://rachelbythebay.com/w/2011/06/07/forked/)å’Œ[ä¸€ä¸ªåç»­](https://rachelbythebay.com/w/2014/08/16/forkenv/)æ˜¯ï¼Œæˆ‘åŸæ¥äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¾ˆå¿«å¿˜è®°äº†è¿™ä»¶äº‹ï¼Œç›´åˆ°æˆ‘åœ¨ç”Ÿäº§ä»£ç ä¸­é‡åˆ°ç›¸å…³é—®é¢˜ã€‚
*   å¯¹æ‚¨[è¢«é²¨é±¼](https://mathemagicalconservation.wordpress.com/2017/02/10/the-real-risk-of-dying-from-shark-attacks-vs-car-accidents-the-importance-of-basic-fractions/)[åé£Ÿçš„](https://mathemagicalconservation.wordpress.com/2018/01/15/risk-of-death-by-sharks-vs-walking/)å¯èƒ½æ€§è¿›è¡Œçš„æ•°å­¦åˆ†æå’Œ[åç»­è¡ŒåŠ¨](https://mathemagicalconservation.wordpress.com/2018/01/15/risk-of-death-by-sharks-vs-walking/)ã€‚

ä¿æŒå®‰å…¨ï¼Œå¹¶æ³¨æ„é²¨é±¼å’Œçº¿ç¨‹ä¸è¿›ç¨‹ä¹‹é—´çš„ä¸è‰¯äº¤äº’ï¼ğŸ¦ˆğŸ¦‘

> æ„Ÿè°¢Terry ReedyæŒ‡å‡ºäº†éœ€æ±‚`if __name__ == '__main__'`ã€‚